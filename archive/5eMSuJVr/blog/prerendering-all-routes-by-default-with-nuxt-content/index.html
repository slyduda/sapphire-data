<!DOCTYPE html><html>
<body><div><div><header><nav><div><div><button><svg><path></path></svg><svg><path></path></svg></button></div><!--[--><div><a>Slyland üèùÔ∏è</a><a>üèùÔ∏è</a></div><!--]--><div><div><div><button><svg><path></path></svg><svg><path></path></svg></button></div><!--[--><div><ul><li><div><!--[--><a>About</a><!--]--></div><!----></li><li><div><!--[--><a>Blog</a><!--]--></div><!----></li><li><div><!--[--><a>Connect</a><!--]--></div><!----></li></ul><div><div><input><label><div><div><svg><circle></circle><line></line><line></line><line></line><line></line><line></line><line></line><line></line><line></line></svg></div></div></label></div></div></div><!--]--></div></div><div><!--[--><!--]--><!--[--><!--]--></div></div></nav></header><div><main><!--[--><div><!--[--><aside><div></div></aside><article><!--[--> <section><h1>Prerendering All Routes By Default With Nuxt Content</h1><div><a><img><div><div>Sylvester Duda</div><div>slyduda.com</div></div></a></div><div><time>Wed, 21 Sep 2022 14:41:33 GMT</time><div>3 min read</div></div><hr><div><div><p><!--[-->When I was first using <code><!--[-->@nuxt/content<!--]--></code> I had trouble figuring out how to render my blog posts. My Nuxt Static site was building correctly, but none of the routes seemed to be getting included. If you are like I was, frustrated that things were not working, you've come to the right place. The issue is that the Nuxt crawler does not know about the routes in the <code><!--[-->/content<!--]--></code> directory it only knows about the routes in <code><!--[-->/pages<!--]--></code>. The crawler looks for links mentioned in the built routes and builds those routes as well. This may be why you might have noticed some <code><!--[-->/content<!--]--></code> routes being included in the final build and others not being included. The workaround is to hard-code all of these routes in your <code><!--[-->nuxt.config.ts<!--]--></code> file like so:<!--]--></p><!--[--><pre><code><span><span>// https://v3.nuxtjs.org/api/configuration/nuxt.config</span></span><span><span>export</span><span> </span><span>default</span><span> </span><span>defineNuxtConfig</span><span>({</span></span><span><span>    </span><span>nitro</span><span>: {</span></span><span><span>        </span><span>prerender</span><span>: {      </span></span><span><span>            </span><span>routes</span><span>: [</span><span>'/blog/post1.md'</span><span>, </span><span>'/blog/post2.md'</span><span>] </span></span><span><span>        },</span></span><span><span>    }</span></span><span><span>}</span></span></code></pre><!--]--><p><!--[-->This isn't ideal (at least for me) because in the future I want to build a CLI that allows me to generate a blog template and have it work out of the box on my next static build without having to try to manipulate any other files. So here's how to do it.<!--]--></p><h2><a><!--[-->The Solution<!--]--></a></h2><p><!--[-->We could write a bash script that travels through the content directory <em><!--[-->OR<!--]--></em> we could take another route and do this insido of Node. To do this we need to install Glob a library that allows us to have access to similar pattern matching that we have in the command line. To get started:<!--]--></p><!--[--><pre><code><span><span>npm install --save-dev glob</span></span></code></pre><!--]--><p><!--[-->The next thing we'll do is import it in our <code><!--[-->nuxt.config.ts<!--]--></code> and start using it to see how we might be able to leverage it directly inside of our config.<!--]--></p><!--[--><pre><code><span><span>import</span><span> </span><span>glob</span><span> </span><span>from</span><span> </span><span>'glob'</span><span>;</span></span><span></span><span><span>const</span><span> </span><span>files</span><span> </span><span>=</span><span> </span><span>glob</span><span>.</span><span>sync</span><span>(</span><span>'content'</span><span> </span><span>+</span><span> </span><span>'/**/*'</span><span>)</span></span><span><span>console</span><span>.</span><span>log</span><span>(</span><span>files</span><span>)</span></span><span></span><span><span>// https://v3.nuxtjs.org/api/configuration/nuxt.config</span></span><span><span>export</span><span> </span><span>default</span><span> </span><span>defineNuxtConfig</span><span>({</span></span><span><span>    </span><span>nitro</span><span>: {</span></span><span><span>        </span><span>prerender</span><span>: {      </span></span><span><span>            </span><span>routes</span><span>: [</span><span>'/blog/post1.md'</span><span>, </span><span>'/blog/post2.md'</span><span>, ...</span><span>files</span><span>]</span></span><span><span>        },</span></span><span><span>    }</span></span><span><span>}</span></span></code></pre><!--]--><p><!--[-->One issue we have is that we don't need to prepend each route with <code><!--[-->content<!--]--></code>. Another issue is the routes that we are including. With the following directory:<!--]--></p><!--[--><pre><code><span><span>/content
|---/blog
    |---post1.md
    |---post1.md</span></span></code></pre><!--]--><p><!--[-->Our files array would include <code><!--[-->/blog<!--]--></code> in the list of files as well. If we already have a Nuxt Page for <code><!--[-->/blog<!--]--></code> this would be fine and Nuxt would see the route in the <code><!--[-->pages<!--]--></code> directory, but if we did not, we would be telling nuxt to render a route that does not exist since <code><!--[-->/blog<!--]--></code> is a directory and not a file. Along with that if we have any other file types (for whatever reason) like <code><!--[-->.jpg<!--]--></code> inside of our content folder we would run into the same issue.<!--]--></p><p><!--[-->To fix this, we need to do some filtering:<!--]--></p><!--[--><pre><code><span><span>// These are Contents supported formats</span></span><span><span>const</span><span> </span><span>formats</span><span> </span><span>=</span><span> [</span><span>'.md'</span><span>, </span><span>'.json'</span><span>, </span><span>'.csv'</span><span>, </span><span>'yml'</span><span>]</span></span><span></span><span><span>const</span><span> </span><span>files</span><span> </span><span>=</span><span> </span><span>glob</span><span>.</span><span>sync</span><span>(</span><span>'content'</span><span> </span><span>+</span><span> </span><span>'/**/*'</span><span>)</span></span><span><span>contentFiles</span><span> </span><span>=</span><span> </span><span>files</span></span><span><span>    .</span><span>map</span><span>(</span><span>dir</span><span> </span><span>=&gt;</span><span> </span><span>dir</span><span>.</span><span>replace</span><span>(</span><span>'content'</span><span>, </span><span>''</span><span>))</span></span><span><span>    .</span><span>filter</span><span>(</span><span>dir</span><span> </span><span>=&gt;</span><span> </span><span>formats</span><span>.</span><span>some</span><span>(</span><span>ft</span><span> </span><span>=&gt;</span><span> </span><span>dir</span><span>.</span><span>endsWith</span><span>(</span><span>ft</span><span>)))</span></span><span><span>    .</span><span>map</span><span>(</span><span>dir</span><span> </span><span>=&gt;</span><span> </span><span>dir</span><span>.</span><span>replace</span><span>(</span><span>/\.</span><span>[</span><span>^</span><span>/</span><span>.</span><span>]+</span><span>$</span><span>/</span><span>, </span><span>""</span><span>));</span></span><span><span>console</span><span>.</span><span>log</span><span>(</span><span>contentFiles</span><span>)</span></span></code></pre><!--]--><p><!--[-->The first map gets rid of the <code><!--[-->content<!--]--></code> portion of the directory. The filter makes sure that any file not supported by <code><!--[-->@nuxt/content<!--]--></code> is not included in the array. The last map gets rid of our file type at the end of the file.<!--]--></p><p><!--[-->Our code should now look like the following:<!--]--></p><!--[--><pre><code><span><span>import</span><span> </span><span>glob</span><span> </span><span>from</span><span> </span><span>'glob'</span><span>;</span></span><span></span><span><span>const</span><span> </span><span>files</span><span> </span><span>=</span><span> </span><span>glob</span><span>.</span><span>sync</span><span>(</span><span>'content'</span><span> </span><span>+</span><span> </span><span>'/**/*'</span><span>)</span></span><span></span><span><span>// These are Contents supported formats</span></span><span><span>const</span><span> </span><span>formats</span><span> </span><span>=</span><span> [</span><span>'.md'</span><span>, </span><span>'.json'</span><span>, </span><span>'.csv'</span><span>, </span><span>'yml'</span><span>]</span></span><span><span>const</span><span> </span><span>files</span><span> </span><span>=</span><span> </span><span>glob</span><span>.</span><span>sync</span><span>(</span><span>'content'</span><span> </span><span>+</span><span> </span><span>'/**/*'</span><span>)</span></span><span><span>const</span><span> </span><span>contentFiles</span><span> </span><span>=</span><span> </span><span>files</span></span><span><span>    .</span><span>map</span><span>(</span><span>dir</span><span> </span><span>=&gt;</span><span> </span><span>dir</span><span>.</span><span>replace</span><span>(</span><span>'content'</span><span>, </span><span>''</span><span>))</span></span><span><span>    .</span><span>filter</span><span>(</span><span>dir</span><span> </span><span>=&gt;</span><span> </span><span>formats</span><span>.</span><span>some</span><span>(</span><span>ft</span><span> </span><span>=&gt;</span><span> </span><span>dir</span><span>.</span><span>endsWith</span><span>(</span><span>ft</span><span>)))</span></span><span><span>    .</span><span>map</span><span>(</span><span>dir</span><span> </span><span>=&gt;</span><span> </span><span>dir</span><span>.</span><span>replace</span><span>(</span><span>/\.</span><span>[</span><span>^</span><span>/</span><span>.</span><span>]+</span><span>$</span><span>/</span><span>, </span><span>""</span><span>));</span></span><span></span><span><span>// https://v3.nuxtjs.org/api/configuration/nuxt.config</span></span><span><span>export</span><span> </span><span>default</span><span> </span><span>defineNuxtConfig</span><span>({</span></span><span><span>    </span><span>nitro</span><span>: {</span></span><span><span>        </span><span>prerender</span><span>: {      </span></span><span><span>            </span><span>routes</span><span>: [...</span><span>contentFiles</span><span>]</span></span><span><span>        },</span></span><span><span>    }</span></span><span><span>}</span></span></code></pre><!--]--><p><!--[-->Tada! Each supported file in the <code><!--[-->content<!--]--></code> directory should now be discoverable.<!--]--></p></div><a> https://sly.re/g54j</a></div><hr></section><section><h3>Engagement</h3><!----><div> There are no <a>WebMentions</a> for this post. </div></section><!--]--></article><aside><div><h2> Table of Contents </h2><nav><ul><!--[--><li><a>The Solution</a><!----></li><!--]--></ul></nav></div></aside><!--]--></div><!--]--></main></div><footer><div><a>Some content</a> on this website is licensed by <a> Creative Commons Attribution-ShareAlike 4.0 International License</a>. This website is part of ongoing project to make an easy accessible static site generator with <a>Nuxt v3</a>. </div><div><a><img></a></div></footer></div></div>
</body></html>